
///////////////////////////////////////////////////////////////////////////////
//
//  FUNCTION:   OnFirstUIAfter
//
//  EVENT:      FirstUIAfter event is sent after file transfer, when installation 
//              is run for the first time on given machine. In this event handler 
//              installation usually displays UI that will inform end user that
//              installation has been completed successfully.
//
///////////////////////////////////////////////////////////////////////////////
function OnFirstUIAfter()
    STRING szTitle, szMsg1, szMsg2, szRegAllCmdLine, szCmd;
    BOOL bOpt1, bOpt2;    
begin
   	// Rename the uex file
   	RenameUEXFile();

	if (SYSINFO.nOSMajor >= 6)  then
		LAAW_SHELLEXECUTEVERB = "runas";
    endif;
	
	// Register Dlls
	RunRegisterAll();
    
    SetDCOMPermissions();
    
 	// Install FKB 
	InstallFKB();
		
	// Install the ESFAMService.exe 
	InstallDotNetService( "\"" + PROGRAMFILES + EXTRACT_DIR ^ "ESFAMService.exe\"");

	// Install the ESFDRSService.exe 
	InstallDotNetService( "\"" + PROGRAMFILES + EXTRACT_DIR ^ "ESFDRSService.exe\"");

	// Install the Extract.ExceptionService
	InstallDotNetService( "\"" + PROGRAMFILES + EXTRACT_DIR ^ "Extract.ExceptionService.exe\"");
	
	// Install the ESIPCService
	InstallDotNetService( "\"" + PROGRAMFILES + EXTRACT_DIR ^ "ESIPCService.exe\"");   
	
	// Register the shell extension
	RegisterLoginNPShellExtension("Extract.Utilities.ShellExtensions.dll");      
	
	// Install the Nuance licenses
	InstallNuanceLicense();
	
	// Install the readme file
	InstallReadme();
	
    Disable(STATUSEX);

	if ( gbInstalled ) then
		szMsg1 = SdLoadString(IFX_SDFINISH_MSG1);   
	    SdFinishReboot(szTitle, szMsg1, SYS_BOOTMACHINE, szMsg2, 0);
	else
		szMsg1 = "Installation was unable to complete, because does not have administrative privileges.";
		SdFinish(szTitle, szMsg1, "Click Finish to exit.", "", "", bOpt1, bOpt2);
	endif;
end; 